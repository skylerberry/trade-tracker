<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <title>Trade Tracker</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Trade Management for Swing Trades</h1>
            <div class="sync-status" id="syncStatus"></div>
        </header>

        <section class="add-trade-section">
            <button id="toggleFormBtn" class="btn btn-primary">+ Add New Trade</button>

            <form id="tradeForm" class="trade-form hidden">
                <h2 id="formTitle">Add New Trade</h2>
                <input type="hidden" id="tradeId">

                <div class="form-grid">
                    <div class="form-group">
                        <label for="ticker">Ticker</label>
                        <input type="text" id="ticker" required placeholder="e.g., AAPL">
                    </div>

                    <div class="form-group">
                        <label for="entryPrice">Entry Price</label>
                        <input type="number" id="entryPrice" step="0.01" required placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label for="entryDate">Entry Date</label>
                        <input type="text" id="entryDate" class="datepicker" required placeholder="Select date">
                    </div>

                    <div class="form-group">
                        <label for="initialSL">Initial Stop Loss</label>
                        <input type="number" id="initialSL" step="0.01" required placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label for="currentSL">Current Stop Loss <button type="button" id="copyInitialSL" class="btn-copy" title="Copy from Initial SL">= Initial</button></label>
                        <input type="number" id="currentSL" step="0.01" required placeholder="0.00">
                    </div>

                    <div class="form-group">
                        <label for="status">Status</label>
                        <select id="status">
                            <option value="open">Open</option>
                            <option value="partially_closed">Partially Closed</option>
                            <option value="closed">Fully Closed</option>
                            <option value="stopped_out">Stopped Out</option>
                        </select>
                    </div>
                </div>

                <h3>Sales</h3>
                <div class="sales-grid">
                    <div class="sale-group">
                        <h4>Sale 1</h4>
                        <div class="sale-fields">
                            <div class="form-group">
                                <label for="sale1Portion">Portion</label>
                                <select id="sale1Portion">
                                    <option value="">-</option>
                                    <option value="1/5">1/5</option>
                                    <option value="1/4">1/4</option>
                                    <option value="1/3">1/3</option>
                                    <option value="1/2">1/2</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="sale1Price">Price</label>
                                <input type="number" id="sale1Price" step="0.01" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label for="sale1Date">Date</label>
                                <input type="text" id="sale1Date" class="datepicker" placeholder="Select date">
                            </div>
                        </div>
                    </div>

                    <div class="sale-group">
                        <h4>Sale 2</h4>
                        <div class="sale-fields">
                            <div class="form-group">
                                <label for="sale2Portion">Portion</label>
                                <select id="sale2Portion">
                                    <option value="">-</option>
                                    <option value="1/5">1/5</option>
                                    <option value="1/4">1/4</option>
                                    <option value="1/3">1/3</option>
                                    <option value="1/2">1/2</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="sale2Price">Price</label>
                                <input type="number" id="sale2Price" step="0.01" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label for="sale2Date">Date</label>
                                <input type="text" id="sale2Date" class="datepicker" placeholder="Select date">
                            </div>
                        </div>
                    </div>

                    <div class="sale-group">
                        <h4>Sale 3</h4>
                        <div class="sale-fields">
                            <div class="form-group">
                                <label for="sale3Portion">Portion</label>
                                <select id="sale3Portion">
                                    <option value="">-</option>
                                    <option value="1/5">1/5</option>
                                    <option value="1/4">1/4</option>
                                    <option value="1/3">1/3</option>
                                    <option value="1/2">1/2</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="sale3Price">Price</label>
                                <input type="number" id="sale3Price" step="0.01" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label for="sale3Date">Date</label>
                                <input type="text" id="sale3Date" class="datepicker" placeholder="Select date">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save Trade</button>
                    <button type="button" id="cancelBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </form>
        </section>

        <section class="filters-section">
            <div class="filter-group">
                <label for="statusFilter">Filter by Status:</label>
                <select id="statusFilter">
                    <option value="all">All Trades</option>
                    <option value="open">Open</option>
                    <option value="partially_closed">Partially Closed</option>
                    <option value="closed">Fully Closed</option>
                    <option value="stopped_out">Stopped Out</option>
                </select>
            </div>
            <button id="exportPdfBtn" class="btn btn-export">Export Open Trades to PDF</button>
            <button id="gistSettingsBtn" class="btn btn-settings">Sync Settings</button>
        </section>

        <!-- Gist Settings Modal -->
        <div id="gistModal" class="modal hidden">
            <div class="modal-content">
                <h2>GitHub Gist Sync</h2>
                <div id="gistSetup">
                    <p>Sync your trades across devices using GitHub Gist.</p>

                    <details class="help-section">
                        <summary>How to get a token (first time setup)</summary>
                        <ol class="help-steps">
                            <li>Click the <a href="https://github.com/settings/tokens/new?scopes=gist&description=Trade%20Tracker" target="_blank">Create token</a> link below</li>
                            <li>Log in to GitHub if prompted</li>
                            <li>Set expiration to <strong>"No expiration"</strong> (recommended)</li>
                            <li>The "gist" checkbox should already be selected</li>
                            <li>Click <strong>"Generate token"</strong> at the bottom</li>
                            <li>Copy the token (starts with <code>ghp_</code>)</li>
                            <li>Paste it below and click "Save & Sync"</li>
                        </ol>
                        <p class="help-note">On a new device? Enter the same token and your Gist ID to sync existing trades.</p>
                    </details>

                    <div class="form-group">
                        <label for="gistToken">GitHub Personal Access Token</label>
                        <input type="password" id="gistToken" placeholder="ghp_xxxxxxxxxxxx">
                        <small>Needs "gist" scope. <a href="https://github.com/settings/tokens/new?scopes=gist&description=Trade%20Tracker" target="_blank">Create token</a></small>
                    </div>
                    <div class="form-group" id="gistIdGroup">
                        <label for="gistId">Gist ID <span class="optional-label">(leave empty for new setup)</span></label>
                        <input type="text" id="gistId" placeholder="Only needed to sync existing trades">
                    </div>
                    <div class="modal-actions">
                        <button id="saveGistSettings" class="btn btn-primary">Save & Sync</button>
                        <button id="cancelGistSettings" class="btn btn-secondary">Cancel</button>
                    </div>
                </div>
                <div id="gistConnected" class="hidden">
                    <p class="sync-connected">Connected to GitHub Gist</p>
                    <p class="gist-id-display">Gist ID: <code id="displayGistId"></code></p>
                    <div class="modal-actions">
                        <button id="forceSyncBtn" class="btn btn-primary">Force Sync Now</button>
                        <button id="disconnectGist" class="btn btn-delete">Disconnect</button>
                        <button id="closeGistModal" class="btn btn-secondary">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <section class="trades-section">
            <div class="table-container">
                <table id="tradesTable">
                    <thead>
                        <tr>
                            <th>Ticker</th>
                            <th>Entry Price</th>
                            <th>Entry Date</th>
                            <th>Initial SL</th>
                            <th>Current SL</th>
                            <th>Sale 1</th>
                            <th>Sale 2</th>
                            <th>Sale 3</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tradesBody">
                    </tbody>
                </table>
            </div>
            <p id="noTrades" class="no-trades hidden">No trades logged yet. Click "Add New Trade" to get started.</p>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
